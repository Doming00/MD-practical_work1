---
title: "Practical Work I"
author: "Group 12.X, names:---"
date: \today
output:
  pdf_document:
    number_sections: yes
    toc: yes
    toc_depth: 2
  html_document:
    toc: no
    toc_depth: '4'
  word_document:
    toc: no
    toc_depth: '4'
geometry: left=1.9cm,right=1.9cm,top=1.25cm,bottom=1.52cm
fontsize: 18pt
subtitle: 'Data Mining 21-22 Q2'
classoption: a4paper
editor_options: 
  
  chunk_output_type: console
---

# Introduction
## Data Description
Variable description

...


## Load Required Packages

```{r paquets, message=FALSE, warning=FALSE}
# Clean workspace
rm(list=ls())

options(contrasts=c("contr.treatment","contr.treatment"))
requiredPackages <- c("effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr", "magrittr","class")
package.check <- lapply(requiredPackages, FUN = function(x) {
  if (!require(x, character.only = TRUE)) {
    install.packages(x, dependencies = TRUE)
    library(x, character.only = TRUE)
  }
})
search()
```

## Some useful functions

```{r funcions}
# Some useful functions
calcQ <- function(x) {
  s.x <- summary(x)
  iqr<-s.x[5]-s.x[2]
  list(souti=s.x[2]-3*iqr, mouti=s.x[2]-1.5*iqr, min=s.x[1], q1=s.x[2], q2=s.x[3], 
       q3=s.x[5], max=s.x[6], mouts=s.x[5]+1.5*iqr, souts=s.x[5]+3*iqr ) }

countNA <- function(x) {
  mis_x <- NULL
  for (j in 1:ncol(x)) {mis_x[j] <- sum(is.na(x[,j])) }
  mis_x <- as.data.frame(mis_x)
  rownames(mis_x) <- names(x)
  mis_i <- rep(0,nrow(x))
  for (j in 1:ncol(x)) {mis_i <- mis_i + as.numeric(is.na(x[,j])) }
  list(mis_col=mis_x,mis_ind=mis_i) }

countX <- function(x,X) {
  n_x <- NULL
  for (j in 1:ncol(x)) {n_x[j] <- sum(x[,j]==X) }
  n_x <- as.data.frame(n_x)
  rownames(n_x) <- names(x)
  nx_i <- rep(0,nrow(x))
  for (j in 1:ncol(x)) {nx_i <- nx_i + as.numeric(x[,j]==X) }
  list(nx_col=n_x,nx_ind=nx_i) }
```

## Load data

Carreguem el dataset i definim el nostre directori de treball

```{r load}
#change working directory
setwd("D:/Drive/UNI/Q8/MD")
library(readr)
df <- read_csv("archive/train.csv")
summary(df)
```

# Initial analisys
 ... 

## Metadata description

```{r}

```

## Univariate descriptive statistics of raw variables

```{r}

```

## Preprocessing of variables

```{r}
names(df)
var_bin <- names(df)[c(2,4,6,18:20)]
summary(df[var_bin])
var_num <- names(df)[c(1,3,7:10,17)]
summary(df[var_num])
var_cat <- names(df)[c(5,11:16,21)]
summary(df[var_cat])
```

### Binary variables

```{r}
var_bin
df[,"blue"]
df$blue <- factor(df$blue, labels = c("NoBth","YesBth"))
summary(df$blue)

df[,"dual_sim"]
df$dual_sim <- factor(df$dual_sim, labels = c("No2Sim","Yes2Sim"))
summary(df$dual_sim)

df[,"four_g"]
df$four_g <- factor(df$four_g, labels = c("No4G","Yes4G"))
summary(df$four_g)

df[,"three_g"]
df$three_g <- factor(df$three_g, labels = c("No3G","Yes3G"))
summary(df$three_g)

df[,"touch_screen"]
df$touch_screen <- factor(df$touch_screen, labels = c("NoTouch","YesTouch"))
summary(df$touch_screen)

df[,"wifi"]
df$wifi <- factor(df$wifi, labels = c("NoWifi","YesWifi"))
summary(df$wifi)
```

No NA's

### Numerical Variables

```{r}
var_num
```

#### Battery Power

```{r}
summary(df$battery_power)
batNa<-which( c(is.na(df$battery_power), df$battery_power <=0, df$battery_power > 4000)) #best mobiles have this many mAh
batNa #doesn't have NA

var_out<-calcQ(df$battery_power)
batOut<-which((df$battery_power>var_out$souts)|(df$battery_power<var_out$souti))
batOut #doesn't have severe outliers
```

#### Clock Speed

```{r}
summary(df$clock_speed)
clkNa<-which( c(is.na(df$clock_speed), df$clock_speed <=0, df$clock_speed > 4))
clkNa #doesn't have NA

var_out<-calcQ(df$clock_speed)
clkOut<-which((df$clock_speed>var_out$souts)|(df$clock_speed<var_out$souti))
clkOut #doesn't have severe outliers
```

#### Internal Memory

```{r}
summary(df$int_memory)
memNa<-which( c(is.na(df$int_memory), df$int_memory <=0, df$int_memory > 128)) 
memNa #doesn't have NA


var_out<-calcQ(df$int_memory)
memOut<-which((df$int_memory>var_out$souts)|(df$int_memory<var_out$souti))
memOut #doesn't have severe outliers
```


#### Mobile Depth

```{r}
summary(df$m_dep)
depNa<-which( c(is.na(df$m_dep), df$m_dep <=0, df$m_dep > 1)) 
depNa #doesn't have NA


var_out<-calcQ(df$m_dep)
depOut<-which((df$m_dep>var_out$souts)|(df$m_dep<var_out$souti))
depOut #doesn't have severe outliers
```

#### Mobile Weigth

```{r}
summary(df$mobile_wt)
weigthNa<-which( c(is.na(df$mobile_wt), df$mobile_wt <=0, df$mobile_wt > 200)) 
weigthNa #doesn't have NA


var_out<-calcQ(df$mobile_wt)
weigthOut<-which((df$mobile_wt>var_out$souts)|(df$mobile_wt<var_out$souti))
weigthOut #doesn't have severe outliers
```

#### Number of Cores

```{r}
summary(df$n_cores)
coreNa<-which( c(is.na(df$n_cores), df$n_cores <=0, df$n_cores > 8)) 
coreNa #has one NA

var_out<-calcQ(df$n_cores)
coreOut<-which((df$n_cores>var_out$souts)|(df$n_cores<var_out$souti))
coreOut #doesn't have severe outliers
```

#### Talk Time

```{r}
summary(df$talk_time)
talkNa<-which( c(is.na(df$talk_time), df$talk_time <=0, df$talk_time > 20)) 
talkNa #has one NA


var_out<-calcQ(df$talk_time)
talkOut<-which((df$talk_time>var_out$souts)|(df$talk_time<var_out$souti))
talkOut #doesn't have severe outliers
```

### Categorical Variables

```{r}
var_cat
```

#### Screen dimension

```{r}
#sc_h * sc_w = screen dimension (cm^2) into factor
df$ScreenDim <- df$sc_h * df$sc_w
df[df$ScreenDim == 0,"ScreenDim"] <- NaN

#knn imputation
dfaux<-df[,c(var_num,var_cat)]
names(dfaux)
aux1 <- dfaux[!is.na(df$ScreenDim),]
aux2 <- dfaux[is.na(df$ScreenDim),]

knn.ing = knn(aux1,aux2,df$ScreenDim[!is.na(df$ScreenDim)])   
df$ScreenDim[is.na(df$ScreenDim)] <- as.numeric(as.character(knn.ing))

summary(df$ScreenDim)
df$ScreenDim <- factor(cut(df$ScreenDim,breaks = c(0,115,230,345)))
levels(df$ScreenDim) <- c("small","medium","big")
summary(df$ScreenDim)
```

#### Front camera quality

```{r}
# fc into factor
summary(df$fc)
length(which(df$fc == 0)) #no tienen camara frontal
df$fc <- factor(cut(df$fc,breaks = c(-0.1,0,5,10,15,20)))
levels(df$fc) <- c("NoFrontCam","bad","regular","good","excellent")
summary(df$fc)
```

#### Main camera quality 

```{r}
# pc into factor
summary(df$pc)
length(which(df$pc == 0)) #no tienen camara principal
df$pc <- factor(cut(df$pc,breaks = c(-0.1,0,5,10,15,21))) 
levels(df$pc) <- c("NoMainCam","bad","regular","good","excellent")
summary(df$pc)
```

#### Pixel Dimension

```{r}
#sqrt(df$px_height^2 + df$px_width)/sqrt(df$sc_h^2 + df$sc_w^2) = pixel_dim into factor
df$pixel_dim <- sqrt(df$px_height^2 + df$px_width)/sqrt(df$sc_h^2 + df$sc_w^2)
summary(df$pixel_dim)
df$pixel_dim <- factor(cut(df$pixel_dim,breaks = c(0,1,300,450,1000)))
levels(df$pixel_dim) <- c("bad","regular","good","excellent")
summary(df$pixel_dim)
```

#####################################################################
#####################################################################
####################### CORREGIR RANGOS #############################
#####################################################################
#####################################################################

#### Ram 

```{r}
#ram into factor
summary(df$ram)
df$ram <- factor(cut(df$ram,breaks = c(255,2048,3072,4096)))
levels(df$ram) <- c("low","mid","high")
summary(df$ram)
```

#### Price range

```{r}
#price range into factor
summary(df$price_range)
df$price_range <- factor(df$price_range,labels = c("low","medium","high","very high"))
summary(df$price_range)
```



















